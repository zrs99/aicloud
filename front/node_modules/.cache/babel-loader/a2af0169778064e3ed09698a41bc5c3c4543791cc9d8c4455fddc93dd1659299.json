{"ast":null,"code":"import VuePdfEmbed from 'vue-pdf-embed';\nimport { ref, onMounted, onUnmounted } from 'vue';\nimport { pdfjs } from 'vue-pdf-embed';\nexport default {\n  components: {\n    VuePdfEmbed\n  },\n  setup() {\n    // 初始化 PDF worker\n    pdfjs.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js';\n\n    // 左侧PDF配置\n    const leftPdf = ref(null);\n    const leftPdfSource = ref('/111.pdf'); // 确保路径正确\n    const leftTotalPages = ref(0);\n    const leftVisiblePages = ref([]);\n    const leftLastPageLoaded = ref(0);\n\n    // 右侧PDF配置\n    const rightPdf = ref(null);\n    const rightPdfSource = ref('/111_qs9p2cE-mono.pdf'); // 确保路径正确\n    const rightTotalPages = ref(0);\n    const rightVisiblePages = ref([]);\n    const rightLastPageLoaded = ref(0);\n    const loading = ref(false);\n    const isScrolling = ref(false);\n    const scrollSyncTimeout = ref(null);\n\n    // 加载PDF文档信息\n    const initPdf = async (source, totalPages) => {\n      try {\n        const pdf = await pdfjs.getDocument(source).promise;\n        totalPages.value = pdf.numPages;\n        return pdf.numPages;\n      } catch (error) {\n        console.error('PDF加载失败:', error);\n        return 0;\n      }\n    };\n\n    // 加载更多页面\n    const loadMorePages = async side => {\n      if (loading.value) return;\n      loading.value = true;\n      try {\n        const config = {\n          left: {\n            pages: leftVisiblePages,\n            lastPage: leftLastPageLoaded,\n            total: leftTotalPages\n          },\n          right: {\n            pages: rightVisiblePages,\n            lastPage: rightLastPageLoaded,\n            total: rightTotalPages\n          }\n        }[side];\n        if (config.lastPage.value >= config.total.value) {\n          loading.value = false;\n          return;\n        }\n        const pagesToLoad = Math.min(3, config.total.value - config.lastPage.value);\n        const newPages = Array.from({\n          length: pagesToLoad\n        }, (_, i) => config.lastPage.value + i + 1);\n        config.pages.value = [...config.pages.value, ...newPages];\n        config.lastPage.value += pagesToLoad;\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 同步滚动处理\n    const handleScroll = event => {\n      if (isScrolling.value) return;\n      isScrolling.value = true;\n      clearTimeout(scrollSyncTimeout.value);\n      scrollSyncTimeout.value = setTimeout(() => isScrolling.value = false, 100);\n      const target = event.target;\n      const isLeft = target === leftPdf.value;\n      const otherElement = isLeft ? rightPdf.value : leftPdf.value;\n\n      // 计算滚动比例\n      const scrollRatio = target.scrollTop / (target.scrollHeight - target.clientHeight);\n      otherElement.scrollTop = scrollRatio * (otherElement.scrollHeight - otherElement.clientHeight);\n\n      // 触发加载更多\n      const threshold = 500;\n      if (target.scrollHeight - (target.scrollTop + target.clientHeight) < threshold) {\n        loadMorePages(isLeft ? 'left' : 'right');\n      }\n    };\n    onMounted(async () => {\n      // 初始化PDF文档\n      const [leftPages, rightPages] = await Promise.all([initPdf(leftPdfSource.value, leftTotalPages), initPdf(rightPdfSource.value, rightTotalPages)]);\n\n      // 初始加载页面\n      await Promise.all([loadMorePages('left'), loadMorePages('right')]);\n\n      // 添加滚动监听\n      leftPdf.value?.addEventListener('scroll', handleScroll);\n      rightPdf.value?.addEventListener('scroll', handleScroll);\n    });\n    onUnmounted(() => {\n      leftPdf.value?.removeEventListener('scroll', handleScroll);\n      rightPdf.value?.removeEventListener('scroll', handleScroll);\n      clearTimeout(scrollSyncTimeout.value);\n    });\n    return {\n      leftPdfSource,\n      leftVisiblePages,\n      rightPdfSource,\n      rightVisiblePages,\n      loading,\n      leftPdf,\n      rightPdf\n    };\n  }\n};","map":{"version":3,"names":["VuePdfEmbed","ref","onMounted","onUnmounted","pdfjs","components","setup","GlobalWorkerOptions","workerSrc","leftPdf","leftPdfSource","leftTotalPages","leftVisiblePages","leftLastPageLoaded","rightPdf","rightPdfSource","rightTotalPages","rightVisiblePages","rightLastPageLoaded","loading","isScrolling","scrollSyncTimeout","initPdf","source","totalPages","pdf","getDocument","promise","value","numPages","error","console","loadMorePages","side","config","left","pages","lastPage","total","right","pagesToLoad","Math","min","newPages","Array","from","length","_","i","handleScroll","event","clearTimeout","setTimeout","target","isLeft","otherElement","scrollRatio","scrollTop","scrollHeight","clientHeight","threshold","leftPages","rightPages","Promise","all","addEventListener","removeEventListener"],"sources":["D:\\Study\\Code\\AICloud\\front\\src\\components\\PDFViewer.vue"],"sourcesContent":["<template>\r\n  <div class=\"dual-pdf-container\">\r\n    <div class=\"pdf-column\" ref=\"leftPdf\">\r\n      <div v-for=\"page in leftVisiblePages\" :key=\"'left-' + page\">\r\n        <vue-pdf-embed\r\n          :source=\"leftPdfSource\"\r\n          :page=\"page\"\r\n          @rendered=\"onPageRendered('left', page)\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"pdf-column\" ref=\"rightPdf\">\r\n      <div v-for=\"page in rightVisiblePages\" :key=\"'right-' + page\">\r\n        <vue-pdf-embed\r\n          :source=\"rightPdfSource\"\r\n          :page=\"page\"\r\n          @rendered=\"onPageRendered('right', page)\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div v-if=\"loading\" class=\"loading\">加载中...</div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VuePdfEmbed from 'vue-pdf-embed'\r\nimport { ref, onMounted, onUnmounted } from 'vue'\r\nimport { pdfjs } from 'vue-pdf-embed'\r\n\r\nexport default {\r\n  components: {\r\n    VuePdfEmbed\r\n  },\r\n  setup() {\r\n    // 初始化 PDF worker\r\n    pdfjs.GlobalWorkerOptions.workerSrc =\r\n      'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js'\r\n\r\n    // 左侧PDF配置\r\n    const leftPdf = ref(null)\r\n    const leftPdfSource = ref('/111.pdf')  // 确保路径正确\r\n    const leftTotalPages = ref(0)\r\n    const leftVisiblePages = ref([])\r\n    const leftLastPageLoaded = ref(0)\r\n\r\n    // 右侧PDF配置\r\n    const rightPdf = ref(null)\r\n    const rightPdfSource = ref('/111_qs9p2cE-mono.pdf') // 确保路径正确\r\n    const rightTotalPages = ref(0)\r\n    const rightVisiblePages = ref([])\r\n    const rightLastPageLoaded = ref(0)\r\n\r\n    const loading = ref(false)\r\n    const isScrolling = ref(false)\r\n    const scrollSyncTimeout = ref(null)\r\n\r\n    // 加载PDF文档信息\r\n    const initPdf = async (source, totalPages) => {\r\n      try {\r\n        const pdf = await pdfjs.getDocument(source).promise\r\n        totalPages.value = pdf.numPages\r\n        return pdf.numPages\r\n      } catch (error) {\r\n        console.error('PDF加载失败:', error)\r\n        return 0\r\n      }\r\n    }\r\n\r\n    // 加载更多页面\r\n    const loadMorePages = async (side) => {\r\n      if (loading.value) return\r\n\r\n      loading.value = true\r\n      try {\r\n        const config = {\r\n          left: {\r\n            pages: leftVisiblePages,\r\n            lastPage: leftLastPageLoaded,\r\n            total: leftTotalPages\r\n          },\r\n          right: {\r\n            pages: rightVisiblePages,\r\n            lastPage: rightLastPageLoaded,\r\n            total: rightTotalPages\r\n          }\r\n        }[side]\r\n\r\n        if (config.lastPage.value >= config.total.value) {\r\n          loading.value = false\r\n          return\r\n        }\r\n\r\n        const pagesToLoad = Math.min(3, config.total.value - config.lastPage.value)\r\n        const newPages = Array.from(\r\n          { length: pagesToLoad },\r\n          (_, i) => config.lastPage.value + i + 1\r\n        )\r\n\r\n        config.pages.value = [...config.pages.value, ...newPages]\r\n        config.lastPage.value += pagesToLoad\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    // 同步滚动处理\r\n    const handleScroll = (event) => {\r\n      if (isScrolling.value) return\r\n\r\n      isScrolling.value = true\r\n      clearTimeout(scrollSyncTimeout.value)\r\n      scrollSyncTimeout.value = setTimeout(() => (isScrolling.value = false), 100)\r\n\r\n      const target = event.target\r\n      const isLeft = target === leftPdf.value\r\n      const otherElement = isLeft ? rightPdf.value : leftPdf.value\r\n\r\n      // 计算滚动比例\r\n      const scrollRatio = target.scrollTop / (target.scrollHeight - target.clientHeight)\r\n      otherElement.scrollTop = scrollRatio * (otherElement.scrollHeight - otherElement.clientHeight)\r\n\r\n      // 触发加载更多\r\n      const threshold = 500\r\n      if (target.scrollHeight - (target.scrollTop + target.clientHeight) < threshold) {\r\n        loadMorePages(isLeft ? 'left' : 'right')\r\n      }\r\n    }\r\n\r\n    onMounted(async () => {\r\n      // 初始化PDF文档\r\n      const [leftPages, rightPages] = await Promise.all([\r\n        initPdf(leftPdfSource.value, leftTotalPages),\r\n        initPdf(rightPdfSource.value, rightTotalPages)\r\n      ])\r\n\r\n      // 初始加载页面\r\n      await Promise.all([\r\n        loadMorePages('left'),\r\n        loadMorePages('right')\r\n      ])\r\n\r\n      // 添加滚动监听\r\n      leftPdf.value?.addEventListener('scroll', handleScroll)\r\n      rightPdf.value?.addEventListener('scroll', handleScroll)\r\n    })\r\n\r\n    onUnmounted(() => {\r\n      leftPdf.value?.removeEventListener('scroll', handleScroll)\r\n      rightPdf.value?.removeEventListener('scroll', handleScroll)\r\n      clearTimeout(scrollSyncTimeout.value)\r\n    })\r\n\r\n    return {\r\n      leftPdfSource,\r\n      leftVisiblePages,\r\n      rightPdfSource,\r\n      rightVisiblePages,\r\n      loading,\r\n      leftPdf,\r\n      rightPdf\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.dual-pdf-container {\r\n  display: flex;\r\n  height: 100vh;\r\n  background: #f0f0f0;\r\n}\r\n\r\n.pdf-column {\r\n  flex: 1;\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  padding: 20px;\r\n  background: white;\r\n  box-shadow: 0 0 10px rgba(0,0,0,0.1);\r\n}\r\n\r\n.pdf-column:first-child {\r\n  border-right: 1px solid #ddd;\r\n}\r\n\r\n.vue-pdf-embed {\r\n  margin-bottom: 20px;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.loading {\r\n  position: fixed;\r\n  bottom: 30px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background: #2196f3;\r\n  color: white;\r\n  padding: 8px 16px;\r\n  border-radius: 20px;\r\n  font-size: 14px;\r\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}