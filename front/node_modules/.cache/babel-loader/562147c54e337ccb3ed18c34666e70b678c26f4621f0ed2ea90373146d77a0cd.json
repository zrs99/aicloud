{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"pdf-container\",\n  ref: \"pdfContainer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.pages, page => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: page.pageNumber,\n      class: \"pdf-page\"\n    }, [_createElementVNode(\"canvas\", {\n      ref_for: true,\n      ref: el => {\n        if (el) $data.canvases[page.pageNumber - 1] = el;\n      }\n    }, null, 512 /* NEED_PATCH */)]);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_Fragment","_renderList","$data","pages","page","key","pageNumber","_createElementVNode","ref_for","el","canvases"],"sources":["D:\\Study\\Code\\AICloud\\front\\src\\components\\socketTest.vue"],"sourcesContent":["<template>\r\n  <div class=\"pdf-container\" ref=\"pdfContainer\">\r\n    <div v-for=\"page in pages\" :key=\"page.pageNumber\" class=\"pdf-page\">\r\n      <canvas :ref=\"el => { if (el) canvases[page.pageNumber-1] = el }\"></canvas>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as pdfjsLib from 'pdfjs-dist'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      pdfDoc: null,\r\n      pages: [],\r\n      canvases: [],\r\n      currentPage: 1,\r\n      isRendering: false,\r\n      pageRendering: false\r\n    }\r\n  },\r\n  async mounted() {\r\n    // 初始化PDF.js worker\r\n    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js'\r\n\r\n    // 加载PDF文档\r\n    const loadingTask = pdfjsLib.getDocument('your-pdf-file.pdf')\r\n    this.pdfDoc = await loadingTask.promise\r\n\r\n    // 初始化页面数组\r\n    this.pages = Array.from({ length: this.pdfDoc.numPages }, (_, i) => ({\r\n      pageNumber: i + 1\r\n    }))\r\n\r\n    // 初始渲染前几页\r\n    this.renderPages(1, Math.min(3, this.pdfDoc.numPages))\r\n\r\n    // 添加滚动事件监听\r\n    window.addEventListener('scroll', this.handleScroll)\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener('scroll', this.handleScroll)\r\n  },\r\n  methods: {\r\n    async renderPages(start, end) {\r\n      if (this.isRendering) return\r\n      this.isRendering = true\r\n\r\n      for (let i = start; i <= end; i++) {\r\n        if (this.pageRendering || i > this.pdfDoc.numPages) continue\r\n\r\n        this.pageRendering = true\r\n        const page = await this.pdfDoc.getPage(i)\r\n        const viewport = page.getViewport({ scale: 1.5 })\r\n\r\n        const canvas = this.canvases[i-1]\r\n        const context = canvas.getContext('2d')\r\n        canvas.height = viewport.height\r\n        canvas.width = viewport.width\r\n\r\n        await page.render({\r\n          canvasContext: context,\r\n          viewport: viewport\r\n        }).promise\r\n\r\n        this.pageRendering = false\r\n      }\r\n\r\n      this.isRendering = false\r\n    },\r\n    handleScroll() {\r\n      const scrollPosition = window.scrollY + window.innerHeight\r\n      const containerBottom = this.$refs.pdfContainer.offsetHeight\r\n\r\n      // 当滚动到接近底部时加载更多页面\r\n      if (scrollPosition > containerBottom - 500 &&\r\n          this.currentPage < this.pdfDoc.numPages &&\r\n          !this.isRendering) {\r\n        const nextPage = this.currentPage + 1\r\n        this.renderPages(nextPage, Math.min(nextPage + 2, this.pdfDoc.numPages))\r\n        this.currentPage = nextPage\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.pdf-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 20px;\r\n  padding: 20px;\r\n}\r\n\r\n.pdf-page {\r\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);\r\n  margin-bottom: 20px;\r\n}\r\n</style>"],"mappings":";;EACOA,KAAK,EAAC,eAAe;EAACC,GAAG,EAAC;;;uBAA/BC,mBAAA,CAIM,OAJNC,UAIM,I,kBAHJD,mBAAA,CAEME,SAAA,QAJVC,WAAA,CAEwBC,KAAA,CAAAC,KAAK,EAAbC,IAAI;yBAAhBN,mBAAA,CAEM;MAFsBO,GAAG,EAAED,IAAI,CAACE,UAAU;MAAEV,KAAK,EAAC;QACtDW,mBAAA,CAA2E;MAHjFC,OAAA;MAGeX,GAAG,EAAEY,EAAE;QAAA,IAAUA,EAAE,EAAEP,KAAA,CAAAQ,QAAQ,CAACN,IAAI,CAACE,UAAU,QAAMG,EAAE;MAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}